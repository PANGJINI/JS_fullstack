<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>종합 실습 01</title>
    <style>
        table, div {
            width: 800px;
            margin: 0 auto;
            border: 1px solid gray;
            border-collapse: collapse;
        }
        input {
            width: 130px;
        }
        div {
            text-align: center;
        }

        td, th {
            border: 1px solid gray;
        }
        #go-list {
            display:none;
        }

    </style>
</head>
<body>
    <button id="list-button">데이터 가져오기</button>
    
    <div>
        <input type="text" id="name" placeholder="이름"/>
        <input type="text" id="city" placeholder="시/도"/>
        <input type="text" id="street" placeholder="구/군/동"/>
        <input type="text" id="suite" placeholder="상세주소"/>
        <input type="text" id="zipcode" placeholder="우편주소"/>
    </div>
    <button id="write-button">데이터 추가하기</button>
    <button id="go-list">목록으로</button>

    <table class="user-table">
        <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>street</th>
                <th>suite</th>
                <th>city</th>
                <th>zipcode</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
        
    </table>
</body>
<script src="service01.js"></script>
<script src="layout.js"></script>
<script>
    // 버튼 가져오기
    const listButton = document.getElementById("list-button");
    const writeButton = document.getElementById("write-button");
    // 데이터가 출력될 부분 (tbody)
    const tbody = document.querySelector("table.user-table tbody");
    // 목록 보기 버튼
    const goListButton = document.getElementById("go-list");

    // 목록 보기 버튼
    goListButton.addEventListener("click", async (e) => {
        const text = await userService.findAll(userLayout.showList);
        tbody.innerHTML = text;
    })

    // 상세 보기 이벤트
    tbody.addEventListener("click", async (e) => {
        e.preventDefault();
        if(e.target.classList[0] === 'go-detail') {
            const userId = e.target.getAttribute("href");
            goListButton.style.display = "inline-block";
            tbody.innerHTML = await userService.read(userId, userLayout.showUser);
        }
    })
    

    // 이벤트 처리도 모듈화하려면?
    const listButtonClickEvent = async (e) => {
        const text = await userService.findAll(userLayout.showList);
        tbody.innerHTML = text;

        // const detailLinks = document.querySelectorAll("a.go-detail");
        // detailLinks.forEach((link) => {
        //     link.addEventListener("click", (e) => {

        //     })
        // })

        //tbody.innerHTML = await userService.read(3, userLayout.showUser);

        //userService.findAll(userLayout.showList);

    }
    //listButton.addEventListener("click", buttonClickEvent);



    

    
    // 전체 조회 버튼을 클릭했을 때
    // listButton.addEventListener("click", async (e) => {
    //     // 리팩토링
    //     userService.findAll(userLayout.showList);
    // });


    // 추가 버튼을 눌렀을 때
    const writeButtonClickEvent = async (e) => {
    //writeButton.addEventListener("click", async (e) => {

        // 사용자가 화면에 입력한 정보 가져오기
        const name = document.getElementById("name").value;
        const street = document.getElementById("street").value;
        const suite = document.getElementById("suite").value;
        const city = document.getElementById("city").value;
        const zipcode = document.getElementById("zipcode").value;

        // // CRUD 중 C(Create)를 요청
        // const response = await fetch(
        //     "https://jsonplaceholder.typicode.com/users",
        //     {
        //         method: 'post',     //post로 요청해줘야 한다.
        //         body: JSON.stringify({  //서버로 데이터 삽입 요청 보내는 것이기 때문에 request body
        //             name: name,
        //             street: street,
        //             suite: suite,
        //             city: city,
        //             zipcode:zipcode,
        //         }),
        //         headers: {  //header는 객체를 담는다
        //             //Content-Type에는 request body에 어떤 타입의 데이터가 담겼는지를 알려준다.
        //             //json 객체가 담겼기 때문에 application/json, 숫자가 담긴다면 number, 
        //             'Content-Type': 'application/json; charset=utf-8'
        //         }
        //     }
        // );  //fetch 끝
        
        // // 추가된 새로운 회원 정보
        // const user = await response.json();
        // //console.log(user);

        
        // 객체화
        const createdUser = {
            name:name, street:street, suite:suite, city:city, zipcode:zipcode,
        }

        // 서버에 전달해서 회원을 추가하고,
        // 새롭게 추가된 회원 정보를 tr태그 문자열 값으로 전달받는다.
        const newText = await userService.create(createdUser, userLayout.showUser);
        // 다시 전체 회원 조회
        const text = await userService.findAll(userLayout.showList);

        
        // 전체 목록 출력
        tbody.innerHTML = text;
        // 맨 뒤에 새로운 회원 출력
        tbody.innerHTML += newText;
        // tbody.innerHTML += `
        //         <tr>
        //             <td>${user.id}</td>
        //             <td>${user.name}</td>
        //             <td>${user.street}</td>
        //             <td>${user.suite}</td>
        //             <td>${user.city}</td>
        //             <td>${user.zipcode}</td>
        //         </tr>
        // `;
    }






    // 리팩토링
    listButton.addEventListener("click", listButtonClickEvent);
    writeButton.addEventListener("click", writeButtonClickEvent);

    
</script>
</html>