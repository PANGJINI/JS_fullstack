<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²¨ë¶€íŒŒì¼ ì¸ë„¤ì¼</title>
    <!-- ì¸ë„¤ì¼ì˜ ëª©ì  -->
    <!-- 
        ì›ë³¸ ì´ë¯¸ì§€ì˜ í¬ê¸°ê°€ í¬ê¸° ë•Œë¬¸ì—,
        ì‘ì€ ì´ë¯¸ì§€ë¡œ í™”ë©´ì— ì¶œë ¥í•˜ì—¬, ì„œë²„ì˜ ë¶€ë‹´ì„ ëœì–´ì£¼ê¸° ìœ„í•¨. 
    -->
    <style>
        div.wrap {
            position: relative;
            display: flex;
            align-items: center;
            width: 150px;
            height: 150px;
            margin: 0 auto;
        }

        div.image {
            background-image: url("./a.png");
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            width: 150px;
            height: 150px;
            cursor: pointer;
            border: 1px solid gray;

        }

        div.cancle {
            display: none;
            cursor: pointer;
            position: absolute;
            background-image: url("./cancle.png");
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            margin: 0 auto;
            width: 30px;
            height: 30px;
            right: 15px;
            top: 0;

        }
    </style>
</head>
<body>
    <div class="wrap">
        <!--lableì„ ëˆ„ë¥´ë©´ input íƒœê·¸ë¡œ ì—°ê²°-->
        <label for="attach">
            <div class="image"></div>
        </label>
        <div class="cancle"></div>
    </div>
    <!--
        type=fileì—ëŠ” multipleì†ì„±ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
        í•´ë‹¹ ì†ì„±ì„ ì§€ì •í•˜ë©´ íŒŒì¼ì„ ì—¬ëŸ¬ê°œ ì—…ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.

        ğŸ’–html íŒŒì¼ì˜ <src>ì— ì´ë¯¸ì§€ì˜ ì ˆëŒ€ê²½ë¡œë¥¼ ì§€ì •í•˜ë©´
        í¬ë¡¬ì˜ ë³´ì•ˆ ì •ì±… ìƒ ì´ë¯¸ì§€ë¥¼ ì¶œë ¥í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤.
        Base64ì˜ í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©ì„ í•´ì„œ ì „ë‹¬í•˜ë©´ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.
    -->
    <input type="file" id="attach" style="display: none;">   
</body>

<script>
    const input = document.getElementById("attach");
    const thumnail = document.querySelector("div.image");
    const cancle = document.querySelector("div.cancle");

    //ì—…ë¡œë“œí•œ íŒŒì¼ ì •ë³´ê°€ input íƒœê·¸ì˜ valueì— ë“¤ì–´ê°„ë‹¤.
    //íŒŒì¼ì´ ì—…ë¡œë“œ ë  ë•Œ valueê°€ ë³€í™”ëœë‹¤.
    //ë”°ë¼ì„œ í´ë¦­ì´ë²¤íŠ¸ë¥¼ ì£¼ê²Œ ë˜ë©´, ì—…ë¡œë“œ ë˜ê¸° ì „ì— ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— changeê°€ ì í•©í•˜ë‹¤.
    input.addEventListener("change", (e) => {
        //console.log(e.target.files);
        
        //ë¹„êµ¬ì¡°í™” í• ë‹¹
        //ì—…ë¡œë“œëœ íŒŒì¼ì„ ê°€ì ¸ì˜¨ë‹¤
        //e.target.filesëŠ” FileList ìë£Œí˜•ì´ë‹¤.
        const [file] = e.target.files;

        const reader = new FileReader();    //ì—…ë¡œë“œëœ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆëŠ” FileReader ê°ì²´
        reader.readAsDataURL(file);    //íŒŒì¼ì˜ ë‚´ìš©ì´ ì•„ë‹ˆë¼ ì ˆëŒ€ê²½ë¡œë¥¼ ì½ê² ë‹¤ëŠ” ì˜ë¯¸
        
        //ê²½ë¡œë¥¼ ì½ì–´ì˜¤ëŠ” ë°©ì‹ì´ stream ë°©ì‹ì´ë‹¤.
        //readerê°ì²´ê°€ íŒŒì¼ì„ ë‹¤ ì½ì–´ì™”ë‹¤ë©´ load ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
        //ì´ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆã…‡ë¥´ ë•Œ reader ê°ì²´ëŠ” ì¸ì½”ë”©ëœ ì ˆëŒ€ê²½ë¡œë¥¼ ê°€ì§„ë‹¤.
        reader.addEventListener("load", (e) => { 
            //x ë²„íŠ¼ì´ ë³´ì´ë„ë¡ í•¨
            cancle.style.display = "block";

            //base64ë¡œ ì¸ì½”ë”©ëœ ê²½ë¡œë¥¼ src()ì— ë‹´ì•„ì£¼ë©´ í•´ë‹¹ ê²½ë¡œì˜ ì´ë¯¸ì§€ë¥¼ ì¶œë ¥í•œë‹¤.
            if(e.target.result.includes("image")) {
                thumnail.style.backgroundImage = `url("${e.target.result}")`;
                //x ë²„íŠ¼ì´ ë³´ì—¬ì•¼ í•˜ëŠ” ê³³

            } else {
                thumnail.style.backgroundImage = `url("./")`;
            }
            
        })
    })


    //cancle ë²„íŠ¼ì´ ëˆŒë¦¬ë©´
    cancle.addEventListener("click", (e) => {

        //1. ë§¨ ì²˜ìŒ ì´ë¯¸ì§€ë¡œ ë³€ê²½
        thumnail.style.backgroundImage = "url('./a.png')";

        //2. input íƒœê·¸ì˜ value ì´ˆê¸°í™”í•´ì£¼ê¸°
        input.value="";

        //3. X ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        cancle.style.display = "none";
    })
</script>
</html>